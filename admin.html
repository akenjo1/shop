<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Quản Trị - Login Only</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* CSS Styles giữ nguyên */
        body { font-family: 'Inter', sans-serif; background-color: #1f2937; color: #d1d5db; }
        .modal-bg { /* ... */ }
        .form-input, .form-select, .form-textarea { background-color: #374151; border: 1px solid #4b5563; color: white; border-radius: 0.5rem; padding: 0.75rem 1rem; width: 100%; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.5); }
        .btn { padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; text-align: center; cursor: pointer; transition: background-color 0.2s; display: inline-block; } /* Sửa: Không để width: 100% mặc định */
        .btn-primary { background-color: #4f46e5; color: white; } .btn-primary:hover { background-color: #4338ca; } .btn-primary:disabled { background-color: #374151; cursor: not-allowed; }
        .btn-secondary { background-color: #4b5563; color: white; } .btn-secondary:hover { background-color: #6b7280; }
        .btn-danger { background-color: #e11d48; color: white; } .btn-danger:hover { background-color: #be123c; }
        .nav-tab { /* ... */ } .nav-tab.active { /* ... */ }
        .spinner { border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #4f46e5; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Bỏ màn hình loading */
        #init-error-message { margin-top: 1rem; text-align: center; word-break: break-word; color: #f87171; font-weight: bold; font-family: monospace; font-size: 0.9em; background-color: #374151; padding: 1rem; border-radius: 0.5rem; border: 1px solid #4b5563;} 
         #admin-login-view { display: none; } /* Mặc định ẩn đi */
         #admin-login-view.visible { display: flex; } /* Hiện ra khi cần */

    </style>
</head>
<body class="antialiased">

    <!-- KHÔNG CÓ MÀN HÌNH LOADING BAN ĐẦU -->
    <!-- Khu vực hiển thị lỗi khởi tạo (nếu có) -->
    <div id="init-error-message" class="fixed top-5 left-1/2 -translate-x-1/2 z-50 p-4 bg-red-800 text-white rounded hidden"></div>


    <!-- Admin Login View -->
    <div id="admin-login-view" class="items-center justify-center min-h-screen p-4"> <!-- Sửa: Bỏ hidden ban đầu -->
        <!-- Nội dung form đăng nhập đầy đủ -->
        <div class="w-full max-w-md bg-gray-800 p-8 rounded-lg shadow-2xl">
            <h1 class="text-3xl font-bold text-white text-center mb-6">Đăng Nhập Quản Trị</h1>
            <div id="login-error-message" class="bg-red-500 text-white p-3 rounded mb-4 hidden"></div>
            <form id="admin-login-form">
                <div class="mb-4">
                    <label for="admin-email" class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="admin-email" class="form-input" required>
                </div>
                <div class="mb-6">
                    <label for="admin-password" class="block text-sm font-medium mb-2">Mật khẩu</label>
                    <input type="password" id="admin-password" class="form-input" required>
                </div>
                <!-- SỬA LỖI NÚT BẤM -->
                <button type="submit" id="admin-login-submit" class="btn btn-primary w-full"> <!-- Thêm lại w-full -->
                    <span class="btn-text">Đăng Nhập</span>
                    <span class="btn-loader hidden"><div class="spinner mx-auto" style="width: 20px; height: 20px; border-width: 2px;"></div></span>
                </button>
            </form>
        </div>
    </div>
    <!-- End Admin Login View -->

    <!-- Admin Main View (Placeholder) -->
    <div id="admin-main-view" class="container mx-auto p-4 md:p-8 hidden">
       <h1 class="text-3xl text-green-400">Đăng nhập Admin thành công! (Giao diện đầy đủ sẽ ở đây)</h1>
        <button id="admin-logout-btn" class="btn btn-danger mt-4">Đăng Xuất</button>
    </div>

    <!-- Modals (Không cần thiết cho bản test này) -->
    <!-- Alert Toast (Không cần thiết cho bản test này) -->

    <script>
        // =============================================================
        // === KEY SUPABASE CỦA BẠN ĐÃ ĐƯỢC DÁN VÀO ĐÂY ===
        // =============================================================
        const SUPABASE_URL = 'https://okzaxfrazdowplynvpps.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9remF4ZnJhemRvd3BseW52cHBzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyMDYzMTUsImV4cCI6MjA3Njc4MjMxNX0.rMKUCMnkNg3uldS7SAwR-o-fCFdUiDBvq_51iHERjsQ';
        // =============================================================

        // --- Utility Functions ---
        const $ = (selector) => document.querySelector(selector);
        const show = (el) => { 
            if(el) {
                el.classList.remove('hidden'); 
                if (el.id === 'admin-login-view') el.classList.add('visible'); 
            }
        };
        const hide = (el) => { 
            if(el) {
                el.classList.add('hidden'); 
                if (el.id === 'admin-login-view') el.classList.remove('visible'); 
            }
        };
        const enable = (btn) => { /* ... */ };
        const disable = (btn) => { /* ... */ };

        // --- Hàm hiển thị lỗi khởi tạo ---
        function showInitError(message, details = '') { 
             console.error("Initialization Error:", message, details);
             const errorDiv = $('#init-error-message');
             if (errorDiv) {
                 errorDiv.innerHTML = `<b>Lỗi Khởi Tạo:</b> ${message}` + (details ? `<br><small>${details}</small>` : '');
                 show(errorDiv); 
             }
             // Ẩn login view nếu có lỗi init
             hide($('#admin-login-view'));
        }

        // --- Hàm hiển thị màn hình Login/Admin ---
        function showLoginScreen(errorMessage = null) { 
            console.log("Showing Login Screen. Error:", errorMessage);
            hide($('#admin-main-view'));
            show($('#admin-login-view')); 
            const errorMsg = $('#login-error-message');
            if (errorMessage) { errorMsg.textContent = errorMessage; show(errorMsg); } 
            else { hide(errorMsg); }
        }
        function showAdminPanel() { 
             console.log("Showing Admin Panel");
             hide($('#admin-login-view'));
             show($('#admin-main-view'));
            // Tạm thời không tải data
        }

         // SỬA LỖI: Khai báo appState ở phạm vi toàn cục TRƯỚC khi sử dụng
         let appState = { 
            supabase: null,
            user: null, 
         };

         // --- Hàm Kiểm Tra Admin (Chỉ gọi sau khi đăng nhập) ---
         async function checkAdminStatus(user) { /* ... logic như v13 ... */ }
        // --- Hàm Đăng Nhập (Cập nhật để gọi checkAdmin) ---
        async function handleLoginSubmit(e) { /* ... logic như v13 ... */ }
        // --- Hàm Đăng Xuất ---
        async function handleLogout() { /* ... logic như v13 ... */ }


        // --- Hàm Khởi Tạo Siêu Tối Giản (v21 - Fix appState) ---
        function initializeLoginOnly() {
            try {
                console.log("Admin Init V21: Starting..."); 

                // 1. Kiểm tra config
                if (!SUPABASE_URL || SUPABASE_URL === 'YOUR_SUPABASE_URL' || !SUPABASE_ANON_KEY || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY') {
                    throw new Error("Chưa cấu hình Supabase URL/Key.");
                }
                console.log("Admin Init V21: Config OK.");

                // 2. Khởi tạo Supabase Client
                try {
                    // SỬA LỖI: Gán vào appState đã được khai báo
                    appState.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY); 
                    console.log("Admin Init V21: Supabase client created.");
                } catch (clientError) {
                     throw new Error(`Lỗi tạo Supabase client: ${clientError.message}.`);
                }
                
                // 3. HIỂN THỊ NGAY MÀN HÌNH LOGIN
                console.log("Admin Init V21: Showing Login Screen directly.");
                showLoginScreen(); // Gọi hàm hiển thị màn hình login

                 // 4. Gắn listener đăng xuất (nếu cần)
                 const logoutBtn = $('#admin-logout-btn');
                 if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);


            } catch (initError) {
                // Bắt tất cả lỗi từ các bước trên và hiển thị
                showInitError(initError.message); 
            }
        }


        // --- Event Listeners --- (Chỉ cần listener cho login)
        function addLoginListener() { 
             const loginForm = $('#admin-login-form');
             if (loginForm) loginForm.addEventListener('submit', handleLoginSubmit);
         }

        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Admin page loaded. Initializing auth V21..."); 
            initializeLoginOnly(); // Gọi hàm khởi tạo siêu đơn giản
            addLoginListener(); 
        });
    </script>
</body>
</html>


